<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>MIDI API TEST</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/cupertino/jquery-ui.min.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.16/angular.min.js"></script>
    <!-- Use the Google AJAX Libraries API:
      http://code.google.com/apis/ajaxlibs/ -->
</head>
<body>
    <div id="mario" style="
    position: absolute;
    top: 300px;
    left: 300px;
    "><img src="http://orig13.deviantart.net/0afd/f/2013/155/3/c/8_bit_link_by_themagicalcrumpet-d67tmj5.png" alt=""　></div>
    <div id="error-massage" style="display: none;">残念</div>
    <script type="text/javascript">
    var mario, onFailure, onMessage, onSuccess, setup;

    onSuccess = function(midiAccess) {
        return setup(midiAccess);
    };

    onFailure = function(msg) {
        document.querySelector('#mario').style.display = 'none';
        return document.querySelector('#error-message').style.display = 'block';
    };

    if (navigator.requestMIDIAccess) {
        navigator.requestMIDIAccess().then(onSuccess, onFailure);
    } else {
        onFailure();
    }

    setup = function(midi) {
        midi.inputs.forEach(function(input) {
            return input.onmidimessage = onMessage;
        });
        return mario.style.top = '300px';
    };

    mario = document.querySelector('#mario');

    onMessage = function(event) {
        var data;
        data = event.data;
        if (data[2] === 127) {
            return mario.style.top = '0px';
        }
        else {
            return mario.style.top = '300px';
        }
    };

    </script>
</body>

</html>
